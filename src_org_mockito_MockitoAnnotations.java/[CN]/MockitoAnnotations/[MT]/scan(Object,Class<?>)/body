{
  AnnotationEngine annotationEngine=new GlobalConfiguration().getAnnotationEngine();
  Field[] fields=clazz.getDeclaredFields();
  for (  Field field : fields) {
    for (    Annotation annotation : field.getAnnotations()) {
      Object mock=annotationEngine.createMockFor(annotation,field);
      if (mock != null) {
        boolean wasAccessible=field.isAccessible();
        field.setAccessible(true);
        try {
          field.set(testClass,mock);
        }
 catch (        IllegalAccessException e) {
          throw new MockitoException("Problems initiating mocks annotated with " + annotation,e);
        }
 finally {
          field.setAccessible(wasAccessible);
        }
      }
    }
  }
}
