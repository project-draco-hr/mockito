{
  ClassLoader loader=Thread.currentThread().getContextClassLoader();
  if (loader == null) {
    loader=ClassLoader.getSystemClassLoader();
  }
  Enumeration<URL> resources;
  try {
    resources=loader.getResources("mockito-extensions/" + service.getName());
  }
 catch (  IOException e) {
    throw new MockitoException("Failed to load " + service,e);
  }
  List<T> result=new ArrayList<T>();
  for (  URL resource : Collections.list(resources)) {
    try {
      InputStream in=resource.openStream();
      InputStreamReader reader=new InputStreamReader(in,"UTF-8");
      String className=new PluginFileReader().readPluginClass(reader);
      if (className == null) {
        continue;
      }
      if (!pluginSwitcher.isEnabled(className)) {
        continue;
      }
      Class<?> pluginClass=loader.loadClass(className);
      Object plugin=pluginClass.newInstance();
      result.add(service.cast(plugin));
    }
 catch (    Exception e) {
      throw new MockitoConfigurationException("Failed to load " + service + " using "+ resource,e);
    }
  }
  return result;
}
