{
  try {
    mutex.lock();
    if (isCurrentlySerializing()) {
      System.out.println("[" + returningProxyCounter.getAndIncrement() + "] retuning proxy");
      return proxy;
    }
    markMockAsSerializing();
    System.out.println("[" + returningWrapperCounter.getAndIncrement() + "] returning wrapper");
    return new AcrossJVMMockSerializationProxy(proxy);
  }
 catch (  IOException ioe) {
    throw new NotSerializableException(proxy.getClass().getCanonicalName());
  }
 finally {
    unmarkMockAsSerializing();
    mutex.unlock();
  }
}
