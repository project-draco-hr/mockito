{
  if (lastMethodIsVoidMethod()) {
    throw new RuntimeExceptionWrapper(new IllegalStateException("void method cannot return a value"));
  }
  if (returnValue == null) {
    return;
  }
  Class<?> returnedType=lastInvocation.getMethod().getReturnType();
  if (returnedType.isPrimitive()) {
    returnedType=null;
  }
  if (!returnedType.isAssignableFrom(returnValue.getClass())) {
    throw new RuntimeExceptionWrapper(new IllegalStateException("incompatible return value type"));
  }
}
