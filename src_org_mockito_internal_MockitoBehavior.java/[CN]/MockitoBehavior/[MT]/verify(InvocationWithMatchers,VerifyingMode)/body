{
  int actuallyInvoked=numberOfActualInvocations(invocation);
  if (verifyingMode.numberOfInvocationsMatters()) {
    int expectedInvoked=verifyingMode.getExactNumberOfInvocations();
    if (actuallyInvoked != expectedInvoked) {
      throw new NumberOfInvocationsAssertionError(expectedInvoked,actuallyInvoked,invocation);
    }
  }
 else {
    if (actuallyInvoked == 0) {
      InvocationWithMatchers similarInvocation=findSimilarInvocation(invocation);
      String message="\n" + "Invocation differs from actual" + "\n";
      String expected=invocation.toString();
      if (similarInvocation != null) {
        String actual=similarInvocation.toString();
        if (expected.equals(actual)) {
          expected=invocation.toStringWithArgumentTypes();
          actual=similarInvocation.toStringWithArgumentTypes();
        }
        message+="Expected: " + expected + "\n"+ "Actual:   "+ actual;
      }
 else {
        message="\n" + "Expected but not invoked:" + "\n"+ expected;
      }
      throw new VerificationAssertionError(message);
    }
  }
}
