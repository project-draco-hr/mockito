{
  Field[] fields=context.getDeclaredFields();
  for (  Field field : fields) {
    if (field.isAnnotationPresent(Spy.class) && !field.isAnnotationPresent(InjectMocks.class)) {
      assertNoIncompatibleAnnotations(Spy.class,field,Mock.class,org.mockito.MockitoAnnotations.Mock.class,Captor.class);
      Object instance=null;
      try {
        FieldInitializationReport report=new FieldInitializer(testInstance,field).initialize();
        instance=report.fieldInstance();
      }
 catch (      MockitoException e) {
        new Reporter().cannotInitializeForSpyAnnotation(field.getName(),e);
      }
      try {
        if (new MockUtil().isMock(instance)) {
          Mockito.reset(instance);
        }
 else {
          field.setAccessible(true);
          field.set(testInstance,Mockito.mock(instance.getClass(),withSettings().spiedInstance(instance).defaultAnswer(Mockito.CALLS_REAL_METHODS).name(field.getName())));
        }
      }
 catch (      IllegalAccessException e) {
        throw new MockitoException("Problems initiating spied field " + field.getName(),e);
      }
    }
  }
}
