{
  Type genericReturnType=invocation.getMethod().getGenericReturnType();
  if (genericReturnType instanceof Class) {
    return mock((Class<?>)genericReturnType,this);
  }
  MockitoGenericMetadata returnTypeGenericMetadata=actualParameterizedType(invocation.getMock()).resolveGenericReturnType(invocation.getMethod());
  Object mock=returnTypeGenericMetadata.toMock(this);
  if (mock == null) {
    return delegate.returnValueFor(returnTypeGenericMetadata.rawType());
  }
  return mock;
}
